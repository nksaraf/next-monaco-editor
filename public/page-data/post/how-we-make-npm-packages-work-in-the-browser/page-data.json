{"componentChunkName":"component---src-templates-post-js","path":"/post/how-we-make-npm-packages-work-in-the-browser","webpackCompilationHash":"43a07f76784e304bf1a0","result":{"data":{"blogPost":{"fields":{"authors":["Ives van Hoorne"],"date":"2017-10-06T00:00:00.000Z","description":"We upgraded our npm support to be 99.98% cheaper and 2,000% faster using serverless.","photo":"https://avatars0.githubusercontent.com/u/587016?s=460&v=4","slug":"how-we-make-npm-packages-work-in-the-browser","title":"How we make npm packages work in the browser"},"frontmatter":{"banner":{"publicURL":"/static/banner-349d1f8eed7441b2a4f8902528c07633.png"}},"html":"<p>I always left <a href=\"https://npmjs.com\">npm</a> dependency support out of scope during\ninitial development of <a href=\"https://codesandbox.io\">CodeSandbox</a>. I thought it would\nbe impossible to install an arbitrary, random amount of packages in the browser,\neven thinking about it caused my brain to block.</p>\n<p>Nowadays npm support is one of the most defining features of CodeSandbox, so\nsomehow we succeeded in making it work. It took a lot of iterations to make it\nwork in any scenario, we did multiple rewrites and even now we can still improve\nthe logic. I'll explain how npm support started, what we have now and what we\nstill can do to improve it.</p>\n<section>\n<h2 id=\"first-version\"><a href=\"#first-version\" aria-label=\"first version permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>'First' Version</h2>\n<p>I really didn't know how to approach this, so I started with a very simple\nversion of npm support:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4bd1c2cd928c0a0a7d3ed93674922b7c/e106a/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.4280722189866%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAABH0lEQVQoz2NQ1rUwsLBRt7CX1jUWVdWDIzE1fUElbRVj6/r2ntbeiUDU0jOhuXtCU1d/Y2dfa8/EkpomBl0LZ1N7J30bByVjSzk9c2kdU2ltEyApq2cmoqpv7Rnw8vnzb1++vHn18tvXr//B4N+/f0Dy2YuXDOrGdlbWHoa2rrpmdhomtkoGlnK6ZrI6pkBSXM3AzNlr/4EDR44cvXTp8stXL9++e//z58/fv38DNd97+IhBUc/czMRO38ZF08xWzdBK3dBK1cBSXs9c0cBSAshx93/0+PHr169fvXr1FdXmh4+fMMjqmklpm0hqGklqGQORFITUNpHRNRNW0bXxCvz27RtQ6d+/f/+BAYpmkA+xIVmIZk+oZogGdJuHpmYA/0gSLC+sM9UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The absolute first version, importing styled-components and React (25 Nov 2016)\"\n        title=\"The absolute first version, importing styled-components and React (25 Nov 2016)\"\n        src=\"/static/4bd1c2cd928c0a0a7d3ed93674922b7c/bcf2d/0.png\"\n        srcset=\"/static/4bd1c2cd928c0a0a7d3ed93674922b7c/d5c4a/0.png 185w,\n/static/4bd1c2cd928c0a0a7d3ed93674922b7c/04e89/0.png 370w,\n/static/4bd1c2cd928c0a0a7d3ed93674922b7c/bcf2d/0.png 740w,\n/static/4bd1c2cd928c0a0a7d3ed93674922b7c/dbb75/0.png 1110w,\n/static/4bd1c2cd928c0a0a7d3ed93674922b7c/a808b/0.png 1480w,\n/static/4bd1c2cd928c0a0a7d3ed93674922b7c/e106a/0.png 1717w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This version of npm support was very simple. It wasn't even really npm support,\nI just installed the dependencies locally and stubbed every dependency call with\nan already installed dependency. This, of course, is absolutely not scalable to\n400,000 packages with different versions.</p>\n<p>Even though this version was not very usable, it was encouraging to see that I\nwas able to at least make two dependencies work in a sandbox environment.</p>\n</section>\n<section>\n<h2 id=\"webpack-version\"><a href=\"#webpack-version\" aria-label=\"webpack version permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>webpack Version</h2>\n<p>I was quite satisfied with the first version, and I thought it would be\nsufficient for an <a href=\"https://en.wikipedia.org/wiki/Minimum_viable_product\">MVP</a>\n(the first release of CodeSandbox). I didn't think it would be even possible to\ninstall any dependency without performing magic. That was until I stumbled upon\n<a href=\"https://github.com/voronianski/esnextbin\">https://esnextb.in</a>. They already\nsupported any dependency from npm, you could just define them in <code class=\"language-text\">package.json</code>\nand it magically worked!</p>\n<p>This was a big learning moment for me. I never dared to give proper npm support\na thought, because I thought 'it would be impossible'. Only after seeing living\nproof of its 'possibleness' I started putting more thought into it. I should've\nexplored the possibilities first before dismissing the idea.</p>\n<p>So! I started thinking on how to approach this. And boy did I overcomplicate it.\nMy first version didn't fit in my head, so I had to draw a diagram:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 696px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d61fc7f3ba43b918c874cacbe0476c81/a82ee/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 158.76436781609195%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAIAAACdAM/hAAAACXBIWXMAAAsSAAALEgHS3X78AAACNElEQVQ4y5XV2VJiUQwFUP//A3mRKkvFAgQZBNpmtBdn24d7aWglD1Rukp05h7vJZPLx8fHrHyKcTqej0eiadj6f3+E+27TZbNbrtV8Wn9eJwQXwcrmUjph+D4fDNbAAF8ACLhaL90L/iXwZvNvt1DMej6lvBq9Wq2UhLm5IO6Zy1mcFv729VeFlsDjU2+1WtpHu93tCYQmr010hqhZYVwaDwWw2UyQ+QwL2yfp3oVkh7potPIJJTYV0VEi2YM/Pzw8PD6+vr+lcv99XiE+NaIEXhVROUfOkIKnVJhcGzbX5ikwBT1f7jMkaRoJJ/xIjBpI9ghd/yXddDzQpFL8BY94bdOx27XCyrW1fF8IoRwxly/98VBnGcDh8fHzkPl0VsNr5fHl5eXp60tE6+RNYZC29v7/XW2BCcQ6FsjZ1FjE+B0sJwFSz3nw1B8Pj2ZGd1jNSfLyq0FQVAjAvlPnLn3cxskuthjESDc/LtFAkqQIYA6MvGF38AsuT2g7wnVya244Aer1eJHlqWuBMMilln+tt0ArrBMCSdiZ3GhULogxWe/F8qZyEnYxSvLwILT9tq2HSTsMwWdt8ip+FxVDpQm7+1DA67nPeqZNp5ZNIJk8e+xNYSd1u13hkRaHIYSEeSWyYhnFxdcOygCz4lhh81ib4es/n4CSTtjVTre9OzvP71zPV5r8G5bDlJe3zZ+giOLvd6XTcWU6FF5IfgbOteTc4ytrk2r8H/4SOh5GXaXUjgWjnHwfqP64BNPSoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The first idea, probably wrong even\"\n        title=\"The first idea, probably wrong even\"\n        src=\"/static/d61fc7f3ba43b918c874cacbe0476c81/a82ee/1.png\"\n        srcset=\"/static/d61fc7f3ba43b918c874cacbe0476c81/d5c4a/1.png 185w,\n/static/d61fc7f3ba43b918c874cacbe0476c81/04e89/1.png 370w,\n/static/d61fc7f3ba43b918c874cacbe0476c81/a82ee/1.png 696w\"\n        sizes=\"(max-width: 696px) 100vw, 696px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>There was one advantage of this overcomplicated approach: the actual\nimplementation was much easier than expected!</p>\n<p>I learned that <a href=\"https://github.com/webpack/webpack\"><code class=\"language-text\">webpack</code></a>'s\n<a href=\"https://webpack.js.org/plugins/dll-plugin\">DllPlugin</a> was able to bundle\ndependencies and spit out a JS bundle with a manifest. This manifest looked like\nthis:</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dll_bundle\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"./node_modules/fbjs/lib/emptyFunction.js\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./node_modules/fbjs/lib/invariant.js\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./node_modules/fbjs/lib/warning.js\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./node_modules/react\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./node_modules/fbjs/lib/emptyObject.js\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./node_modules/object-assign/index.js\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./node_modules/prop-types/checkPropTypes.js\"</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./node_modules/prop-types/lib/ReactPropTypesSecret.js\"</span><span class=\"token operator\">:</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"./node_modules/react/cjs/react.development.js\"</span><span class=\"token operator\">:</span> <span class=\"token number\">8</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n<p>Every path is mapped to a module id. If I would require\n<a href=\"https://github.com/facebook/react\">React</a> I would only have to call\n<code class=\"language-text\">dll_bundle(3)</code> and I would get React! This was perfect for our use case, so I\nstarted typing away and came up with this actual system:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/053e799d3b3670a2cbf6f414d6583b15/4dacb/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.74680306905371%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAA3klEQVQY04WQyxKDMAhF+f/fc+lKnfqKJrY+o1V7Jsxk3PUuCBDgXpBhGMZx/ASc5zlNE8474DiO67rWdaVg33d+Cbdt03qs8FRVVZYlU/BfAVmWGWPoNwFd1/V9T7Vzrq5r/DRNSYq11gXgMJ4PfAYRwum9ZyL+siw+gBG0FUXRtq18A1CIRZj6GgLViYT7vmOB7gKTxFSEhljdmSuwFM06EQs/5CiSSPKUEJPUcREUolyT8zyzQtM0DJUn1VOChjTQyQlZEn561CZJkuf5H2YWg5ODQ6jjOAEZ7oryHxEpyuwFRf0FAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"The source of the service can be found here: https://github.com/CompuIves/codesandbox-bundler. This service also contains code to publish any sandbox to npm (really cool), we scrapped this feature later on.\"\n        title=\"The source of the service can be found here: https://github.com/CompuIves/codesandbox-bundler. This service also contains code to publish any sandbox to npm (really cool), we scrapped this feature later on.\"\n        src=\"/static/053e799d3b3670a2cbf6f414d6583b15/bcf2d/2.png\"\n        srcset=\"/static/053e799d3b3670a2cbf6f414d6583b15/d5c4a/2.png 185w,\n/static/053e799d3b3670a2cbf6f414d6583b15/04e89/2.png 370w,\n/static/053e799d3b3670a2cbf6f414d6583b15/bcf2d/2.png 740w,\n/static/053e799d3b3670a2cbf6f414d6583b15/4dacb/2.png 782w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>For every request to the packager I would create a new directory in\n<code class=\"language-text\">/tmp/:hash</code>, would run <code class=\"language-text\">yarn add ${dependencyList}</code> and let <code class=\"language-text\">webpack</code> bundle\nafterwards. I'd save the new bundle on\n<a href=\"https://cloud.google.com/sdk/gcloud\">gcloud</a> as a way of caching. Much simpler\nthan the diagram, mostly because I replaced installing dependencies with\n<a href=\"https://yarnpkg.com\">yarn</a> and bundling with <code class=\"language-text\">webpack</code>.</p>\n<p>When you load a sandbox, we would first make sure that we'd have the manifest\nand the bundle before evaluation. During evaluation we would call\n<code class=\"language-text\">dll_bundle(:id)</code> for every dependency. This worked very well, and I got my\nfirst version with proper npm dependency live!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/30534439f0d380e2887c555c96c12b55/093af/3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.44125326370757%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACD0lEQVQoz2Pwzq4NLu31LugydvJR09RS09VX1dRR0dBW1dRW1dIBimgam2m6eam6eCAjFRcPLVdPBjVVZW1dbTVNNXUNbRNDXX19HXU9bVUdLSV1dXlVNXExCYeYhKJ7b1Iv3k+5/BCCUi8/TLj0oOLGEwYVLR0tAyMNfUMtPSMLCxMjE30dI31NfV01HR1VbW0RKen0rOz//////fv3PwZgUFBR09DRU9PWBZI6hsYySsrS8opAJKOgJK+sJigqnpqRCVT39dPXH5++/3j/9ce7Lz8+fv/x9efff/9AmtV19YGa1bR0dPWMVNU1FFVUldTU5RRV5JRU+IVEs/LzXt182eXSOi1xRl/Jgv7WdRMSZyxKnvXt4zewZh09IFJQVddU0TAyMNDU0QQKyioqKyirCgiJZRfmv7jyos6opnfF6ckzlk7fda61e/cC/4nfPn5H0SyroKQPDGF1DQU1dSUNDTVtLVFJqbziogcX72eox2Xn9WR3z03tWxQVXVPlVPzp7SeEZkU1DSk5BR1tHT1DQyAb6Gag4/mFxbJzc5++eBNb0dPcPm3KohWT5i/tm71w7vRF3z5/QdKsqi6vAIwgTQU1NVklZXCAqQqIiKWmZQAD7ObPv1//gUL4H1pow21WVVZVVlSWAgc1WLMKUHMKWDMwqv79+/cXCaBoBvpZGqYNplkVrvk3UDNGPAMAJY0NST0d6YYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Whoop! We got material-ui and react running dynamically! (24 Dec 2016)\"\n        title=\"Whoop! We got material-ui and react running dynamically! (24 Dec 2016)\"\n        src=\"/static/30534439f0d380e2887c555c96c12b55/bcf2d/3.png\"\n        srcset=\"/static/30534439f0d380e2887c555c96c12b55/d5c4a/3.png 185w,\n/static/30534439f0d380e2887c555c96c12b55/04e89/3.png 370w,\n/static/30534439f0d380e2887c555c96c12b55/bcf2d/3.png 740w,\n/static/30534439f0d380e2887c555c96c12b55/dbb75/3.png 1110w,\n/static/30534439f0d380e2887c555c96c12b55/a808b/3.png 1480w,\n/static/30534439f0d380e2887c555c96c12b55/093af/3.png 1915w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now there was still a big limitation with this system. It didn't support files\nthat were not in the dependency graph of <code class=\"language-text\">webpack</code>. This means that for example\n<code class=\"language-text\">require(&#39;react-icons/lib/fa/fa-beer&#39;)</code> wouldn't work, because it was never\nrequired by the entry point of the dependency in the first place.</p>\n<p>I did release CodeSandbox with this version though, and got in contact with the\nauthor of <a href=\"https://github.com/cerebral/webpackbin\">WebpackBin</a>\n<a href=\"https://twitter.com/christianalfoni\">Christian Alfoni</a>. We used a very similar\nsystem to support npm dependencies and we were having the same limitations. So\nwe decided to combine forces and build the <strong>ultimate</strong> packager!</p>\n</section>\n<section>\n<h2 id=\"webpack-with-entries\"><a href=\"#webpack-with-entries\" aria-label=\"webpack with entries permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>webpack with entries</h2>\n<p>The \"ultimate\" packager retained the same functionality as our previous\npackager, except <a href=\"https://twitter.com/christianalfoni\">Christian</a> created an\nalgorithm that would add files to the bundle depending on their importance. This\nmeans that we manually added entry points, to make sure that <code class=\"language-text\">webpack</code> would\nbundle those files too. After a lot of tweaking of this system we got it working\nfor any(?) combination. So you were able to require\n<a href=\"https://github.com/react-icons/react-icons\"><code class=\"language-text\">react-icons</code></a>, and CSS files as\nwell 🎉.</p>\n<p><blockquote class=\"twitter-tweet\" data-dnt=\"true\"><p lang=\"en\" dir=\"ltr\">We did it! <a href=\"https://twitter.com/christianalfoni\">@christianalfoni</a> and I combined forces and created a common NPM bundler for WebpackBin and CodeSandbox! 1/2 <a href=\"https://t.co/6X3hxamLyN\">pic.twitter.com/6X3hxamLyN</a></p>&mdash; Ives van Hoorne (@CompuIves) <a href=\"https://twitter.com/CompuIves/status/855865667739951106\">April 22, 2017</a></blockquote></p>\n<p>The new system also got an architectural upgrade: we have one\n<a href=\"https://en.wikipedia.org/wiki/Dynamic-link_library\">DLL</a> service that serves as\nload balancer and cache. Then we have multiple packagers that do the bundling,\nthese packagers can be dynamically added.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/38cb6c9117299fff7cebaa7403846bf9/5d4cf/4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.124721603563465%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABRElEQVQoz21Ri3aCMAz1/79w0015KIJNSV8UaBF3EeGwzXtCSW9y0zTduSestd7786X4+Dx8fR/TLE/SNM2yU5JezpckAZFnWS6ImqZxC3ZPpTPGwCmralLk5+JaQvx9PO33h4nMMtTFSkT2ia3YSlkDWmulNCssGmaMha0MgCzCxzzrX+KlGP5mw9g/WHKWk+F1bRdCaBrftm2MEZeHMzHeIzQzXTflOET6fmYgnMRgH48Ha3tTahzHvu9nptZWaAUHzDDE4T7ialaW4/0OZhHHiGrEuiL2HaR9iAFHE6tSyHYqhnhAhIiFkCj9EqP12qjK0JUFrDKytoqdJsfTVkvZKOWMU+T5pkVhqITjNP8a2HZCqI3+lbFszdw23nKd0zq8nfsHBDCSECLV+oom44DdqtzijRjgxgjHBYtLLWhu+x1+AJrdb+Mh9IJaAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Packager teamwork!\"\n        title=\"Packager teamwork!\"\n        src=\"/static/38cb6c9117299fff7cebaa7403846bf9/bcf2d/4.png\"\n        srcset=\"/static/38cb6c9117299fff7cebaa7403846bf9/d5c4a/4.png 185w,\n/static/38cb6c9117299fff7cebaa7403846bf9/04e89/4.png 370w,\n/static/38cb6c9117299fff7cebaa7403846bf9/bcf2d/4.png 740w,\n/static/38cb6c9117299fff7cebaa7403846bf9/5d4cf/4.png 898w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We wanted to make the packager service available for everyone. That's why we\nbuilt <a href=\"http://webpack-dll-prod.herokuapp.com/\">a website</a> that would explain how\nthe service works and how you can make use of it. This turned out to be a great\nsuccess, we were even mentioned in the\n<a href=\"https://blog.codepen.io/2017/08/11/using-resources-npm-codepen\">CodePen blog</a>!</p>\n<p>There were still some limitations and disadvantages to this 'ultimate' packager.\nThe costs grew exponentially as we became more popular, and we were caching by\npackage <em>combination</em>. Which means that we had to rebundle your whole package\ncombination if you added a dependency.</p>\n</section>\n<section>\n<h2 id=\"going-serverless\"><a href=\"#going-serverless\" aria-label=\"going serverless permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Going Serverless</h2>\n<p>I always wanted to try this cool technology called\n'<a href=\"https://martinfowler.com/articles/serverless.html\">serverless</a>'. With\nserverless you can define a function that will execute on request, the function\nwill spin up, handle the request and then kill itself after some time. This\nmeans that you have very high scalability: if you get 1000 simultaneous requests\nyou can just spin up 1000 servers instantly. It also means that you only pay for\nthe time the servers actually run.</p>\n<p>Serverless sounds perfect for our service: it doesn't run fulltime and we need\nhigh concurrency in case there are multiple requests at the same time. So I\nstarted playing eagerly with an aptly named framework called\n<a href=\"https://serverless.com\">Serverless</a>.</p>\n<p>Converting our service went smoothly (thanks Serverless!), I had a working\nversion within 2 days. I created three serverless functions:</p>\n<ol>\n<li>A metadata resolver: this service would resolve versions and peerDependencies\nand request the packager function.</li>\n<li>A packager: this service would do the actual installing &#x26; bundling of the\ndependencies</li>\n<li>An uglifier: responsible for asynchronously uglifying the resulting bundle.</li>\n</ol>\n<p>I ran the new service alongside the old service, and it worked really well! We\nhad a projected cost of $0.18 per month (compared to $100) and our response time\nimproved between 40% and 700%.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 678px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2ac091fa99d4ed6f8684ec0e1aa8b8c/6b427/5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 90.7079646017699%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsSAAALEgHS3X78AAACMElEQVQ4y41U266TQBTlm4wvx/gZvnhiYnz0M0w8D57vMDE+nF/wmjT6VFMo19LCAAUKw62l3OGsQg+p1lRX2slmmLXXnrVnYAghLMsKojifz03T9Dxv08N13T8ChPhrmiZJsqqqjuMykizNZjOe50HWNF3XSQ8DiUzLMohhYQQIMXusVkswBUHwfZ9JkiSKIhrQOEnatm2apqqqpm7qum5PgPkx7rpueGQcx0FeGgRhGKJi6lPk2ngbjHEU+76HsmkPSEEDI9Z2PRgUpCwUzGNdGITYM7L0st255qn4gbxarhRFmU6nsixxHDeZTHxK8WJccQEMDBBFiecFuMVyHIwLw2if7dMeUL1ERp22bQdB4Liu7TgBDbCr9drCVuEzzBuq+KtzDIwpirKfagYbgZ5wyF3/juHV0AvkZaI4zvIcU368/86SvIRUe25R06dO8/SH9DMt9ojLsjz0OcsLPHyRksdveTs6xPUZG2KYl33l2YfrBVURF2XBJPGR/FXeXt0u7Ki8QFbo4vru5Qn5QfmbvH3yTrHj/yAHyyN5t0tH8tNb5Z/KL+5eqfSBDLcH8mdp++hGXl8kS9jzx+dIcSRnWbZL4V77i6Sv36+8pOjauiwrNKMoCvQfriIu0fC2I6Hx5tONERkg53nOjLfHMi1REHAdxgNEdDJn2fXaGfqPEYdfFuUk2R5PWJrucMdxt7BUJyZOG245fpAFASUMtLxqXBpalqkRHScPXwXLNO8BgFLw7m3CbfwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"This felt sooooo good\"\n        title=\"This felt sooooo good\"\n        src=\"/static/d2ac091fa99d4ed6f8684ec0e1aa8b8c/6b427/5.png\"\n        srcset=\"/static/d2ac091fa99d4ed6f8684ec0e1aa8b8c/d5c4a/5.png 185w,\n/static/d2ac091fa99d4ed6f8684ec0e1aa8b8c/04e89/5.png 370w,\n/static/d2ac091fa99d4ed6f8684ec0e1aa8b8c/6b427/5.png 678w\"\n        sizes=\"(max-width: 678px) 100vw, 678px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>After several days I started noticing a limitation though: a lambda function\nonly has 500MB of maximum disk space, this means that some combinations of\ndependencies weren't able to install. This was a deal breaker and I had to get\nback to the drawing board.</p>\n<h4 id=\"serverless-revisited\"><a href=\"#serverless-revisited\" aria-label=\"serverless revisited permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Serverless Revisited</h4>\n<p>A couple months went by and\n<a href=\"/post/creating-a-parallel-offline-extensible-browser-based-bundler-for-codesandbox\">I released a new bundler for CodeSandbox</a>.\nThis bundler is very powerful, and allows us to easily support more libraries\nlike <a href=\"https://github.com/vuejs/vue\">Vue</a> and\n<a href=\"https://github.com/preactjs/preact\">Preact</a>. By supporting these libraries we\ngot some interesting requests. For example: if you want to use a\n<a href=\"https://github.com/facebook/react\">React</a> library in Preact, you'd need to\nalias <code class=\"language-text\">require(&#39;react&#39;)</code> to <code class=\"language-text\">require(&#39;preact-compat&#39;)</code>. For Vue, you may want to\nresolve <code class=\"language-text\">@/components/App.vue</code> to your sandbox files. Our packager doesn't do\nthis for dependencies, but our bundler does.</p>\n<p>That's when I started thinking that we could maybe let the browser bundler do\nthe actual packaging. If we would just send the relevant files to the browser\nwe'd let the bundler do the actual bundling of the dependencies. This should be\nfaster, because we're not evaluating the whole bundle, just parts of it.</p>\n<p>There is a great advantage to this approach: we will be able to install and\ncache dependencies independently. We can just merge the dependency files on the\nclient. This means that if you request a new dependency on top of your existing\ndependencies, we'd only need to gather files for the new dependency! This will\nsolve the 500MB limit from <a href=\"https://aws.amazon.com/lambda\">AWS Lambda</a>, since\nwe're only installing one dependency. We can also drop <code class=\"language-text\">webpack</code> from the\npackager, since the packager now has the sole responsibility of figuring out\nwhich files are relevant and sending them.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0fb2c3ba45c7a7925e1dbfc171108022/1589a/6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.8871473354232%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAAAwUlEQVQoz4WR2w6EIAxE+f/PNJioeAUFV4XdE5u4idEwDwTaznRa1DeHfd8/J7Ztu6XUGyel5L231nZdN45j3/fOuXVd0ZIseCUfxzHPc4wxhIDKsiw0h8nz35kiiQKMSSmQOxVkYSJEBC2eUDAyDIPCCcbquq6qSmvNpW1bYww5Mdw0DaVEsI0oJ/GiKMqyVLc56YZ2OEFDgqhftunJHY/TNKGiZPTHmSHIkGJbpkMrv21AE2w/bjtPvv6ZVT3+8w+rbw54PRKAtwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"We parallelize the packaging of the dependencies\"\n        title=\"We parallelize the packaging of the dependencies\"\n        src=\"/static/0fb2c3ba45c7a7925e1dbfc171108022/bcf2d/6.png\"\n        srcset=\"/static/0fb2c3ba45c7a7925e1dbfc171108022/d5c4a/6.png 185w,\n/static/0fb2c3ba45c7a7925e1dbfc171108022/04e89/6.png 370w,\n/static/0fb2c3ba45c7a7925e1dbfc171108022/bcf2d/6.png 740w,\n/static/0fb2c3ba45c7a7925e1dbfc171108022/dbb75/6.png 1110w,\n/static/0fb2c3ba45c7a7925e1dbfc171108022/1589a/6.png 1276w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><em>Note: We could also drop the packager and request every file dynamically from\n<a href=\"https://unpkg.com\">unpkg.com</a>. This is probably even faster than my new\napproach. I decided to still keep the packager (at least for the editor),\nbecause I want to provide offline support. That's only possible if you have\nall possible relevant files with you.</em></p>\n</blockquote>\n<h4 id=\"how-it-works-in-practice\"><a href=\"#how-it-works-in-practice\" aria-label=\"how it works in practice permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>How it works in practice</h4>\n<p>When we request a combination of dependencies, we first check if this\ncombination already is stored on <a href=\"https://aws.amazon.com/s3\">S3</a>. If it's not on\nS3 we request the combination from the API service; this service requests all\npackagers independently for every dependency. As soon as we get the\n<a href=\"https://developer.mozilla.org/nl/docs/Web/HTTP/Status/200\">200 OK</a> back, we\nrequest S3 again.</p>\n<p>The packager installs the dependencies using yarn and finds all relevant files\nby traversing the <a href=\"https://en.wikipedia.org/wiki/Abstract_syntax_tree\">AST</a> of\nall files in the directory of the entry point. It searches for require\nstatements and adds them to the file list. This happens recursively, so we get a\ndependency graph. An example output (of <code class=\"language-text\">react@latest</code>) is this:</p>\n<div class=\"gatsby-highlight\">\n      <pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"aliases\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"asap\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asap/browser-asap.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"asap/asap\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asap/browser-asap.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"asap/asap.js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asap/browser-asap.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"asap/raw\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asap/browser-raw.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"asap/raw.js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asap/browser-raw.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"asap/test/domain.js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"asap/test/browser-domain.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"core-js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"core-js/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"encoding\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"encoding/lib/encoding.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"fbjs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"fbjs/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"iconv-lite\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"iconv-lite/lib/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"iconv-lite/extend-node\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"iconv-lite/streams\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"is-stream\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"is-stream/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"isomorphic-fetch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"isomorphic-fetch/fetch-npm-browserify.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"js-tokens\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"js-tokens/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"loose-envify\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"loose-envify/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"node-fetch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node-fetch/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"object-assign\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"object-assign/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"promise\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"promise/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"prop-types\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prop-types/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react/index.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"setimmediate\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"setimmediate/setImmediate.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ua-parser-js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ua-parser-js/src/ua-parser.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"whatwg-fetch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"whatwg-fetch/fetch.js\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"contents\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"fbjs/lib/emptyFunction.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"fbjs/lib/emptyObject.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"fbjs/lib/invariant.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"fbjs/lib/warning.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./emptyFunction\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"object-assign/index.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"prop-types/checkPropTypes.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"fbjs/lib/invariant\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"fbjs/lib/warning\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"./lib/ReactPropTypesSecret\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"prop-types/lib/ReactPropTypesSecret.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react/index.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./cjs/react.development.js\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react/package.json\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react/cjs/react.development.js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"content\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/* code */\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"requires\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"object-assign\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"fbjs/lib/warning\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"fbjs/lib/emptyObject\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"fbjs/lib/invariant\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"fbjs/lib/emptyFunction\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"prop-types/checkPropTypes\"</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependency\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"16.0.0\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencyDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"asap\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.6\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"core-js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.2.7\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"encoding\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.1.12\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"fbjs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.8.16\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"iconv-lite\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.4.19\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"is-stream\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.1.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"isomorphic-fetch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.2.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"js-tokens\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.0.2\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"loose-envify\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.3.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"node-fetch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.7.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"object-assign\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"4.1.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"promise\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"7.3.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"prop-types\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"15.6.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"setimmediate\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0.5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"ua-parser-js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.7.14\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"whatwg-fetch\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2.0.3\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre>\n      </div>\n</section>\n<section>\n<h2 id=\"advantages\"><a href=\"#advantages\" aria-label=\"advantages permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Advantages</h2>\n<h4 id=\"save-in-cost\"><a href=\"#save-in-cost\" aria-label=\"save in cost permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Save in cost</h4>\n<p>I've deployed the new packager two days ago, we paid a whopping $0.02 for those\ntwo days! And this was for building up the cache. This is a huge saving compared\nto $100 a month.</p>\n<h4 id=\"higher-performance\"><a href=\"#higher-performance\" aria-label=\"higher performance permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Higher performance</h4>\n<p>You can now get a new combination of dependencies within 3 seconds, for any\ncombination. With the old system this sometimes would take a minute. If the\ncombination is cached you'll get it within 50ms on a fast connection. We cache\nthe dependencies using <a href=\"https://aws.amazon.com/cloudfront\">Amazon Cloudfront</a>\nall over the world. Our sandbox also runs faster, because we now only parse and\nexecute the relevant JS files for your sandbox.</p>\n<h4 id=\"more-flexibility\"><a href=\"#more-flexibility\" aria-label=\"more flexibility permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>More flexibility</h4>\n<p>Our bundler now handles the dependencies as if it were local files. This means\nthat our error stack traces are now much clearer, we can now include any file\nfrom dependencies (like <code class=\"language-text\">.scss</code>, <code class=\"language-text\">.vue</code>, etc.) and we can easily support things\nlike aliases. It works just as if the dependencies are installed locally.</p>\n</section>\n<section>\n<h2 id=\"release\"><a href=\"#release\" aria-label=\"release permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Release</h2>\n<p>Two days ago I started using the new packager alongside the old packager, to\nbuild up cache. It already cached 2,000 different combinations and 1400\ndifferent dependencies. I want to test the new version extensively before\nactually moving over. You can try it today by enabling it in your preferences!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 740px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b856e3f0d764038b08c772dd560b7421/0c1ff/7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.7843268586738%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABmklEQVQoz3WSy2vbQBDGBY2tlbSGEr1t7Ur70suOgyM3cRwMOSQ4PfRQSErbQ2+lp/bcYw6BXPMn9xOGYNIEfgzDar75NDtrDW0yGNoHg+G7g4HjUjoaeZQSxwWuRz06whGSXY44JGRg2wBCyyZOPM5YLrJcpBlPMzZmXJrS1K0qayZkLjUXihUSkQs5KQQK0kn2/tDvxapqTk5X85NlrkxWSMTlan15dX223lTTI123ppnuU88X3cVlECeW7bhMKGEqyJBMcsGlRqPu7Bycri+OFl09m8MAXXQ9VaZqu/Or2x9+GPbOQpf4jJbwhBjx2QSCsp3tkmdUWQmlgyjpxVyZenaMIiY1kybX5X7pq2CcIIot4ngTlglRcM6TJI6ikBXFC6v/gVM/MyHO5vbnt79Pn/88XP+6v/n9ON9shVKmQVHzFqadhklqYZ3Hm+360/cPN3fd9svy49dqscKSdDN7ccn74LejZGw5Ho3TcRhFvu8HAcIhdlgokyuNDb8FCvwwgrNHeii6AJeO8LZwi7ZNMNHuqb0KhP8ALLVVVNKqbVAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"7\"\n        title=\"7\"\n        src=\"/static/b856e3f0d764038b08c772dd560b7421/bcf2d/7.png\"\n        srcset=\"/static/b856e3f0d764038b08c772dd560b7421/d5c4a/7.png 185w,\n/static/b856e3f0d764038b08c772dd560b7421/04e89/7.png 370w,\n/static/b856e3f0d764038b08c772dd560b7421/bcf2d/7.png 740w,\n/static/b856e3f0d764038b08c772dd560b7421/dbb75/7.png 1110w,\n/static/b856e3f0d764038b08c772dd560b7421/a808b/7.png 1480w,\n/static/b856e3f0d764038b08c772dd560b7421/0c1ff/7.png 1493w\"\n        sizes=\"(max-width: 740px) 100vw, 740px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><em>Also, if you're interested in the source, you can find it\n<a href=\"https://github.com/codesandbox/dependency-packager\">here</a>.</em></p>\n</blockquote>\n<h4 id=\"go-serverless\"><a href=\"#go-serverless\" aria-label=\"go serverless permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Go Serverless!</h4>\n<p>I am very impressed by serverless, it makes server scalability and management\nincredibly easy. The only thing that always held me back from serverless is the\nvery complicated setup, but the people at\n<a href=\"https://serverless.com\">serverless.com</a> made this child's play. I'm very\ngrateful for their work, I do think that serverless is the future for many\ndifferent application forms.</p>\n</section>\n<section>\n<h2 id=\"future\"><a href=\"#future\" aria-label=\"future permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Future</h2>\n<p>We can still improve the system in a lot of ways, I'm eager to explore\ndynamically requesting requires in embeds and preserving offline. It's a hard\nbalance to keep, but it should be possible. We can also start caching\ndependencies independently in the browser, depending on what the browser allows.\nIn that case you sometimes don't even need to download new dependencies when\nvisiting a new sandbox with different dependency combination. I'm also going to\nexplore dependency resolution more, there is a chance of conflicting versions\nwith the new system which I want to solve before going full on.</p>\n<p>Nevertheless I'm very happy with the new version, onwards to working on new\nthings for CodeSandbox!</p>\n<p><em>If you're interested in CodeSandbox, we're 90% open source! The most activity\nis <a href=\"https://github.com/codesandbox/codesandbox-client\">here</a>.</em></p>\n</section>"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"id":"1a57add5-8308-5713-b9cf-037cea3a3993"}}}